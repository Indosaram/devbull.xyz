---
title: "ì¹´ì¹´ì˜¤ ë§µ API ê¸¸ì°¾ê¸° ì‚¬ìš©í•˜ëŠ” ë°©ë²•"
images: ["https://images.unsplash.com/photo-1604355231395-bf02775c357f?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwxMTc3M3wwfDF8c2VhcmNofDF8fG5hdml8ZW58MHx8fHwxNjM1NTk5MzE4&ixlib=rb-1.2.1&q=80&w=2000"]
date: "2021-10-30T12:55:39.000Z"
tags: ['dev-diary']
---

<TOCInline toc={props.toc} asDisclosure />
## ë“¤ì–´ê°€ë©´ì„œ

[ì¹´ì¹´ì˜¤ API](https://developers.kakao.com/)ëŠ” ì •ë§ í¸ë¦¬í•œ ê¸°ëŠ¥ë“¤ì„ ë¬´ë£Œë¡œ ì œê³µí•˜ê³  ìˆì–´ì„œ ê°œë°œìë“¤ì´ ë§ì´ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë¬¼ë¡  ì¼ì¼ ì œí•œì´ ìˆì§€ë§Œ, íŠ¸ë˜í”½ì´ ë§ì§€ ì•Šì€ ì„œë¹„ìŠ¤ë¼ë©´ ì¶©ë¶„íˆ ì»¤ë²„í•  ìˆ˜ ìˆëŠ” ë§Œí¼ì˜ Quotaê°€ ì œê³µë©ë‹ˆë‹¤.

ê·¸ ì¤‘ ì¹´ì¹´ì˜¤ ì§€ë„ APIê°€ ìœ„ê²½ë„ì—ì„œ ì£¼ì†Œ ë˜ëŠ” ì£¼ì†Œì—ì„œ ìœ„ê²½ë„ ë³€í™˜ì´ ê°€ëŠ¥í•´ ë§ì´ ì‚¬ìš©ë˜ê³  ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ°ë° ì¹´ì¹´ì˜¤ ì§€ë„ APIëŠ” ê¸¸ì°¾ê¸° ê¸°ëŠ¥ì„ ì œê³µí•˜ì§€ ì•Šê³  ëœë”© í˜ì´ì§€ë¡œì˜ ë¦¬ë””ë ‰ì…˜ APIë§Œ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤. ì™œ í•˜í•„ ê¸¸ì°¾ê¸°ë§Œ ë”°ë¡œ ì œê³µí•˜ì§€ ì•ŠëŠ”ì§€ëŠ” ì˜ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤ğŸ˜‚

[ê³µì‹ ë¬¸ì„œ](https://apis.map.kakao.com/web/guide/)ì— ë”°ë¥´ë©´


ì¢Œí‘œë‚˜ ì¥ì†ŒIDë¥¼ ì´ìš©í•˜ì—¬ í•´ë‹¹ ìœ„ì¹˜ì˜ ë¡œë“œë·°ë¥¼ ë°”ë¡œ ì‹¤í–‰í•˜ëŠ” URLì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

| URL Pattern | ì˜ˆì‹œ |
| --- | --- |
| /link/roadview/`ìœ„ë„`,`ê²½ë„` | *[](https://map.kakao.com/link/roadview/37.402056,127.108212)* |
| /link/roadview/`ì¥ì†ŒID` | *[](https://map.kakao.com/link/roadview/18577297)* |


ë¼ê³  í•˜ëŠ”ë°ìš”. Q&A í˜ì´ì§€ì—ì„œë„ ê³µì‹ì ìœ¼ë¡œ ì´ë¥¼ í™•ì¸í•´ì¤˜ì„œ ì•ìœ¼ë¡œë„ ì–¸ì œ ì¶”ê°€ê°€ ë ì§€ëŠ” ëª¨ë¥´ëŠ” ìƒí™©ì…ë‹ˆë‹¤.

[ì§€ë„ api ê¸¸ì°¾ê¸°ê¸°ëŠ¥

ì•ˆë…•í•˜ì„¸ìš” ê¸¸ì°¾ê¸° api ê´€ë ¨í•´ì„œ ê¶ê¸ˆí•œê²Œ ìˆìŠµë‹ˆë‹¤. í˜¹ì‹œ ë‹¤ìŒì§€ë„ ì˜¤í”ˆ apiì—ì„œ ê¸¸ì°¾ê¸° ê¸°ëŠ¥ì€ ì²˜ìŒë¶€í„° ë°°ì œëœ ë¶€ë¶„ì¸ê°€ìš”? ê·¸ê²Œ ì•„ë‹ˆë¼ë©´ ì–¸ì œë¶€í„° ì¢…ë£Œê°€ ëœ ê±´ê°€ìš”?

![](https://devtalk.kakao.com/uploads/default/optimized/2X/4/45637762c7757790ac514e63fb8db66f92156332_2_180x180.png)ì¹´ì¹´ì˜¤ ë°ë¸Œí†¡solyoung3

![](https://devtalk.kakao.com/uploads/default/original/2X/1/177b0155cf38c99fc8afe7af3f766f49d04aaf89.png)](https://devtalk.kakao.com/t/api/44727)

ì¼ë‹¨ ê³µì‹ ë¬¸ì„œì—ì„œ ì•Œë ¤ì¤€ëŒ€ë¡œ ì¥ì†Œ IDë¥¼ ì‚¬ìš©í•´ ëœë”© í˜ì´ì§€ë¥¼ ë§Œë“¤ë ¤ê³  í–ˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ì²˜ìŒì—ëŠ” "í‚¤ì›Œë“œë¡œ ID ì°¾ê¸°" APIë¥¼ ì‚¬ìš©í•´ì„œ ì € ëœë”©í˜ì´ì§€ë¡œ ë“¤ì–´ê°„ ë‹¤ìŒ, ì‹œì‘ ì¥ì†Œë¥¼ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê²¨ì£¼ë ¤ê³  í–ˆìŠµë‹ˆë‹¤. ê·¸ëŸ°ë° ë¬¸ì œëŠ”... ì‹œì‘ ë¶€ë¶„ì— í•´ë‹¹í•˜ëŠ” ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¥¼ ì œëŒ€ë¡œ ì°¾ì§€ ëª»í–ˆë˜ ê²ƒì…ë‹ˆë‹¤. ì–´ë–¤ ë¶€ë¶„ì¸ì§€ëŠ” ì§ì‘ì´ ê°€ëŠ”ë° ê·¸ ë¶€ë¶„ì— ë¬´ìŠ¨ ê°’ì„ ë§Œë“¤ì–´ì„œ ë„£ì–´ì¤˜ì•¼ í• ì§€ë¥¼ ëª¨ë¥´ê² ë”ë¼êµ¬ìš”.

## í•´ê²°ë°©ë²•

ê²°êµ­ì—ëŠ” `selenium` ì„ í™œìš©í•´ ë¸Œë¼ìš°ì € ìë™í™”ë¡œ í•´ê²°í–ˆìŠµë‹ˆë‹¤. Brute force ë°©ì‹ì´ë‚˜ ë§ˆì°¬ê°€ì§€ë¼ ë³„ë¡œ ì¢‹ì§€ëŠ” ì•Šì§€ë§Œ ë”±íˆ ë‹¤ë¥¸ ë°©ë²•ì„ ëª¨ë¥´ê² ë„¤ìš”. í˜¹ì‹œ ì½”ë“œë¥¼ ì‚¬ìš©í•˜ê³  ì‹¶ì€ ë¶„ë“¤ì€ `KAKAO_API_KEY` ë¶€ë¶„ë§Œ ë°œê¸‰ë°›ì€ APIí‚¤ë¡œ êµì²´í•˜ë©´ ë©ë‹ˆë‹¤!

```python
import os
import time

import pandas as pd
from selenium import webdriver
from selenium.common.exceptions import (
    NoSuchElementException,
    ElementNotInteractableException,
)
from selenium.webdriver.common.keys import Keys

KAKAO_API_KEY = ""


class KakaoRouteFinder:
    def __init__(self, driver_path, file_path):
        self.driver = webdriver.Chrome(driver_path)

        self.df = pd.read_excel(file_path)

    def _search_and_select_address(self, target, xpath):
        element = self.driver.find_element_by_xpath(xpath)
        element.click()
        element.send_keys(target)
        element.send_keys(Keys.ENTER)
        time.sleep(1)
        try:
            address_selector = (
                "#info\.flagsearch\.address\.list > li > span.name"
            )
            self.driver.find_element_by_css_selector(address_selector).click()
        except:
            address_selector = (
                "#info\.flagsearch\.place\.list > "
                "li.PlaceFlagItem.clickArea.PlaceFlagItem-ACTIVE > "
                "div.infopanel.clickArea > strong"
            )
            self.driver.find_element_by_css_selector(address_selector).click()

        time.sleep(1)

    def get_distance(self, origin, dest):
        origin = origin.replace("\xa0", " ")
        dest = dest.replace("\xa0", " ")

        base_url = "https://map.kakao.com/?map_type=TYPE_MAP&target=car"
        self.driver.get(base_url)
        time.sleep(1)

        # Preventing clicking not working
        try:
            dimmed_layer_selector = "#dimmedLayer"
            self.driver.find_element_by_css_selector(
                dimmed_layer_selector
            ).click()
        except ElementNotInteractableException:
            pass

        # Inputs origin and destination
        origin_xpath = '//*[@id="info.route.waypointSuggest.input0"]'
        dest_xpath = '//*[@id="info.route.waypointSuggest.input1"]'
        self._search_and_select_address(origin, origin_xpath)
        self._search_and_select_address(dest, dest_xpath)

        # Route by car
        car_selector = "#cartab"
        self.driver.find_element_by_css_selector(car_selector).click()
        time.sleep(1)

        # Select shortest route
        option_list_selector = (
            "#info\.flagsearch > div.CarRouteResultView > "
            "div.info_pathfind > div > div.opt_pathfind"
        )
        self.driver.find_element_by_css_selector(option_list_selector).click()
        option_selector = (
            "#info\.flagsearch > div.CarRouteResultView > div.info_pathfind > "
            "div > div.opt_pathfind > ul > li:nth-child(3) > a"
        )
        self.driver.find_element_by_css_selector(option_selector).click()

        # Get distance
        selector = (
            "#info\.flagsearch > div.CarRouteResultView > ul > li > "
            "div.summary > div > div.contents > p > span.distance > span.num"
        )
        try:
            element = self.driver.find_element_by_css_selector(selector)
        except NoSuchElementException:
            print(f"Invalid address: {origin} -> {dest}")
            return None
        return element.text

    def find_routes(self):
        results = []
        for row in self.df.itertuples():
            try:
                distance = self.get_distance(row.start, row.arrive)
            except Exception as exc:
                print(exc, row)
                distance = None

            results.append(distance)

        self.df["distance"] = results

    def __del__(self):
        self.driver.close()


if __name__ == '__main__':
    # ì£¼ì†Œ ë¦¬ìŠ¤íŠ¸ ì»¬ëŸ¼ì€ start, arrive, distance 3ê°œë¡œ êµ¬ì„±ë¨
    filename = "ì£¼ì†Œ_ë¦¬ìŠ¤íŠ¸.xlsx"
    driver_path = os.path.join(os.getcwd(), "chromedriver.exe")

    kakao_route_fidner = KakaoRouteFinder(driver_path, filename)
    kakao_route_fidner.find_routes()

    print(kakao_route_fidner.df)
    kakao_route_fidner.df.to_excel("ê²°ê³¼.xlsx")

```
